<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TVAC Pro - IPTV Premium</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
  .canal:hover { transform: scale(1.05); transition: 0.2s; }
  .favorito { border: 3px solid #f59e0b !important; }
  .Esportes { background-color: #dbeafe; }
  .Filmes { background-color: #fee2e2; }
  .Infantil { background-color: #d1fae5; }
  .Notícias { background-color: #fef3c7; }
  .Outros { background-color: #e5e7eb; }
  .canal img { width: 100%; height: 100px; object-fit: cover; border-radius: 5px; }
</style>
</head>
<body class="bg-gray-100 font-sans">

<header class="bg-gray-900 text-white py-4 shadow-md text-center">
  <h1 class="text-3xl font-bold">TVAC Pro - IPTV Premium</h1>
</header>

<section class="flex justify-center mt-6">
  <video id="player" controls autoplay class="w-full max-w-6xl border-2 border-gray-800 rounded-md shadow-lg"></video>
</section>

<section class="my-6 flex justify-center gap-4 flex-wrap">
  <input type="text" id="buscaCanais" placeholder="Buscar canal..." class="border p-2 rounded w-80" />
  <button id="mostrarFavoritos" class="bg-yellow-500 px-4 py-2 rounded text-white font-semibold">Favoritos</button>
  <button id="mostrarTodos" class="bg-blue-500 px-4 py-2 rounded text-white font-semibold">Todos</button>
</section>

<main class="max-w-7xl mx-auto p-4">
  <div id="listaCanais" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
</main>

<footer class="bg-gray-900 text-white py-4 mt-10 text-center">
  © 2025 TVAC Pro Premium
</footer>

<script>
const player = document.getElementById('player');
const listaCanais = document.getElementById('listaCanais');
const busca = document.getElementById('buscaCanais');
const btnFavoritos = document.getElementById('mostrarFavoritos');
const btnTodos = document.getElementById('mostrarTodos');

const M3U_URL = 'http://pinheirvip.xyz:80/get.php?username=4HsXxCQD4b&password=YPRvIFHUXZ&type=m3u_plus';
let canais = [];

// Carregar canal no player
function carregarCanal(url){
  if(Hls.isSupported()){
    if(window.hls) window.hls.destroy();
    const hls = new Hls();
    window.hls = hls;
    hls.loadSource(url);
    hls.attachMedia(player);
  } else if(player.canPlayType('application/vnd.apple.mpegurl')){
    player.src = url;
  }
  player.play();
}

// Categorias automáticas
function categoriaAutomatica(nome){
  const n = nome.toLowerCase();
  if(/sport|espn|fox/i.test(n)) return 'Esportes';
  if(/film|movie|cinema/i.test(n)) return 'Filmes';
  if(/kids|cartoon|disney/i.test(n)) return 'Infantil';
  if(/news|cnn|globo/i.test(n)) return 'Notícias';
  return 'Outros';
}

// Criar canal HTML
function criarCanal(nome,url){
  const div = document.createElement('div');
  const categoria = categoriaAutomatica(nome);
  div.className = `canal cursor-pointer border p-2 rounded shadow hover:shadow-lg text-center ${categoria}`;
  div.dataset.nome = nome;
  div.dataset.url = url;
  div.dataset.categoria = categoria;

  // Verificar favorito
  const favoritos = JSON.parse(localStorage.getItem('favoritos')||'[]');
  if(favoritos.includes(nome)) div.classList.add('favorito');

  div.innerHTML = `
    <img src="https://via.placeholder.com/300x100?text=${nome}" />
    <span class="font-semibold block mt-2">${nome}</span>
    <button class="mt-2 px-3 py-1 bg-yellow-400 rounded text-sm">★</button>
  `;

  div.addEventListener('click',(e)=>{
    if(e.target.tagName==='BUTTON'){
      let favs = JSON.parse(localStorage.getItem('favoritos')||'[]');
      if(favs.includes(nome)){
        favs = favs.filter(f=>f!==nome);
        div.classList.remove('favorito');
      } else {
        favs.push(nome);
        div.classList.add('favorito');
      }
      localStorage.setItem('favoritos',JSON.stringify(favs));
      e.stopPropagation();
      return;
    }
    carregarCanal(url);
  });

  listaCanais.appendChild(div);
}

// Parse M3U
async function carregarM3U(){
  try {
    const res = await fetch(M3U_URL);
    const text = await res.text();
    const linhas = text.split('\n');
    for(let i=0;i<linhas.length;i++){
      if(linhas[i].startsWith('#EXTINF')){
        let nome = linhas[i].split(',')[1] || 'Canal';
        let url = linhas[i+1]?.trim();
        if(url) canais.push({nome,url});
      }
    }

    // Criar canais
    canais.forEach(c=> criarCanal(c.nome,c.url));

    // Carregar primeiro canal automaticamente
    if(canais.length>0) carregarCanal(canais[0].url);
  } catch(err){
    console.error('Erro ao carregar M3U:',err);
    listaCanais.innerHTML = '<p class="text-red-600">Não foi possível carregar a lista de canais. Verifique CORS ou a URL do servidor.</p>';
  }
}

// Busca em tempo real
busca.addEventListener('input',()=>{
  const termo = busca.value.toLowerCase();
  document.querySelectorAll('.canal').forEach(c=>{
    const nome = c.dataset.nome.toLowerCase();
    const cat = c.dataset.categoria.toLowerCase();
    c.style.display = (nome.includes(termo)||cat.includes(termo))?'block':'none';
  });
});

// Mostrar favoritos
btnFavoritos.addEventListener('click',()=>{
  const favs = JSON.parse(localStorage.getItem('favoritos')||'[]');
  document.querySelectorAll('.canal').forEach(c=>{
    c.style.display = favs.includes(c.dataset.nome)?'block':'none';
  });
});

// Mostrar todos
btnTodos.addEventListener('click',()=>{
  document.querySelectorAll('.canal').forEach(c=> c.style.display='block');
});

carregarM3U();
</script>
</body>
</html>
